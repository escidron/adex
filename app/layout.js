"use client";

import NavBar from "@/components/NavBar/NavBar";
import { createContext, useState } from "react";
import { useEffect } from "react";
import "./globals.css";
import { Inter } from "next/font/google";
import { Abel } from "next/font/google";
import favicon from "../public/static/favicon.ico";
const inter = Inter({ subsets: ["latin"] });
const abel = Abel({ subsets: ["latin"], weight: ["400"] });

export const metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export const UserContext = createContext();

export default function RootLayout({ children }) {
  const [showLoginModal, setShowLoginModal] = useState(false);
  const [showSignUpModal, setShowSignUpModal] = useState(false);
  const [showForgotPasswordModal, setShowForgotPasswordModal] = useState(false);

  const [user, setUser] = useState({
    isLogged: false,
    checkLogin: false,
    showLoginOptions: false,
    name: "",
    image:'',
    userId:null,
    notificationQuantity:0,
    notifications:[],
    hasPayout:false
  });
  useEffect(() => {
    async function autoLogin() {
      const response = await fetch(
        "http://3.132.48.54:5000/api/users/autologin",
        {
          method: "GET",
          credentials: "include",
        }
      );
      if (response.status === 200) {
        
        setUser((prev) => ({ ...prev, name: user.name, isLogged: true,image:user.image,userId:user.userId }));
      } else {
        setUser((prev) => ({ ...prev, isLogged: false, checkLogin: true,image:user.image }));
      }
    }
    autoLogin();
  }, []);

  return (
    <html lang="en">
      <head>
        <title>ADEX Connect</title>
        <link rel="icon" href={favicon.src} />
        <script
          src="https://maps.googleapis.com/maps/api/js?key=AIzaSyATrfv2ahP3hrMsAP8x5vwq3Hpy6qjGQgM&libraries=places"
          async
        />
      </head>
      <body className={`${abel.className} ${showLoginModal || showSignUpModal?'overflow-hidden':''}`} >
        <UserContext.Provider value={[user, setUser]}>
          <NavBar 
          setShowLoginModal={(toggle)=>setShowLoginModal(toggle)} 
          showLoginModal={showLoginModal}
          setShowSignUpModal={(toggle)=>setShowSignUpModal(toggle)} 
          showSignUpModal={showSignUpModal} 
          showForgotPasswordModal={showForgotPasswordModal}
          setShowForgotPasswordModal={(toggle)=>setShowForgotPasswordModal(toggle)}
        />
        
          {children}
        </UserContext.Provider>
      </body>
    </html>
  );
}
